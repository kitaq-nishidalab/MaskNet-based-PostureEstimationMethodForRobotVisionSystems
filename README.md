# Development of a MaskNet-based Posture Estimation Method for Robot Vision Systems

Fast posture estimation method using SVD and MaskNet was recently proposed.
time-series posture estimation still has the problem of fluctuation owing to sensor and inference errors.
To improve the accuracy of posture estimation in realistic task situations, we trained MaskNet on a large dataset of CAD models generated by ray casting, which simulates views from random viewpoints of a sensor model. 
A Kalman filter was also applied to reduce noise in the inference time series.

### Integration of the MaskNet-based Posture estimation method into Robot vision systems:

<p align="center">
      <img src="https://github.com/user-attachments/assets/66977d8f-ea21-4f9d-96a6-0030557f2d76" width: 100% height: auto >
</p>



 
# Installation

CPU only

```bash
pip install numpy
pip install open3d
pip install -U scikit-learn
pip install h5py
pip install torch==2.2.0
pip install tqdm
pip install torchvision
pip install matplotlib
```

GPU

https://pytorch.org/

```bash
pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```


# 実行手順（Execution steps）


1. 実機の xArm6 を 192.168.1.195 で接続し、RealSenseカメラ (D435i) も立ち上げる。
2. MoveIt!を使ったロボットアームのプランニング機能を設定する。
3. エンドエフェクタの座標系に対してカメラの座標系を正しく登録するプログラムを起動する。
4. RealSenseカメラ (D435i) から得た点群の前処理（ノイズ除去、ダウンサンプリング、背景除去 など）を行うプログラムを起動する。
5. 前処理を行った点群に対して３Ｄオブジェクトの姿勢を推定するプログラムを起動する。


上記のことを実行するために以下のコマンドが必要になる。



To execute the following tasks:

1. Connect the xArm6 to 192.168.1.195 and launch the RealSense D435i camera.
2. Configure the planning functionality for the robotic arm using MoveIt!.
3. Launch a program to register the camera's coordinate system relative to the end effector's coordinate system.
4. Start a program to preprocess point cloud data obtained from the RealSense D435i (e.g., noise removal, downsampling, background removal).
5. Launch a program to estimate the 3D object's pose based on the preprocessed point cloud.

The following command is required:

```bash
cd ~/<work_space>
source devel/setup.bash
roslaunch xarm6_pick_and_place_pkg task.launch pipeline:=ompl
```

上記のコマンドを実行すると以下のようになる。

When the above command is executed, it results in the following.

<div style="display: flex; gap: 10px;">
    <img src="https://github.com/user-attachments/assets/23aa2a8f-dee3-4607-8b37-e40d105f628f" alt="Image 1" width="300">
    <img src="https://github.com/user-attachments/assets/25eec3d1-b905-4baa-8757-d23228e5f8f8" alt="Image 2" width="300">
</div>

もう一つターミナルを開いて以下のコマンドを実行する。

Open another terminal and execute the following command.

```bash
cd ~/<work_space>
roslaunch realsense2_camera rs_camera.launch enable_pointcloud:=true
```

上記のコマンドを実行すると以下のようになる。

When the above command is executed, it results in the following.

<div style="display: flex; gap: 10px;">
    <img src="https://github.com/user-attachments/assets/780fd3d5-f920-4616-8485-043151d0bcd1" alt="Image 1" width="300">
    <img src="https://github.com/user-attachments/assets/261ff09a-5886-44c3-82bf-0d36f127981d" alt="Image 2" width="300">
</div>

# 使い方（Usage）

<div style="display: flex; gap: 10px;">
    <video src=".https://github.com/user-attachments/assets/2fdad2bc-df26-4aa1-b1c3-d2336ef581a0" autoplay muted loop autoplay muted >
</div>

# Acknowledgement

https://github.com/vinits5/masknet/tree/main

# Author
 
* Yu Iwai
* The University of Kitakyushu
 
# License

This project is release under the MIT License.
